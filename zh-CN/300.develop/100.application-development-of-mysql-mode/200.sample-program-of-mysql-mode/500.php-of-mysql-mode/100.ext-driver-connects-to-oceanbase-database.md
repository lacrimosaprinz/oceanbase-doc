|description|本文主要介绍 EXT 驱动连接 OceanBase 数据库，实现创建表、插入数据等基本操作。。|
|---|---|
|keywords||
|dir-name|GORM|
|dir-name-en||
|tenant-type|MySQL Mode|

# EXT 驱动连接  OceanBase 数据库示例程序

本文将介绍如何使用 ext 驱动连接 OceanBase 数据库，实现创建表、插入数据等基本操作。

## 适用版本

OceanBase 数据库所有版本。

## 前提条件

* 您已安装 php 和 php-mysql。
* 您已安装 OceanBase 数据库并且创建了 MySQL 模式租户。

## 操作步骤

1. 检查并安装 php 和 php-mysql 环境。
2. 修改 `obtest.php` 文件中的数据库连接信息。
3. 运行 `obtest.php` 文件并进行验证。

### 步骤一：检查并安装 php 和 php-mysql 环境

执行如下命令安装 PHP 环境。

```shell
sudo yum install php
sudo yum install php-mysql
```

安装成功后返回结果如下：

```sql
Install  1 Package (+9 Dependent packages)

Total download size: 28 M
Installed size: 43 M
Is this ok [y/d/N]: y
Downloading packages:
(1/10): apr-1.4.8-3.1.alios7.x86_64.rpm                                                                       | 102 kB  00:00:00
(2/10): apr-util-1.5.2-6.1.alios7.x86_64.rpm                                                                  |  91 kB  00:00:00
(3/10): httpd-2.4.6-99.1.alios7.1.x86_64.rpm                                                                  | 1.2 MB  00:00:00
(4/10): alios-logos-70.0.6-3.alios7.noarch.rpm                                                                |  21 MB  00:00:00
(5/10): httpd-tools-2.4.6-99.1.alios7.1.x86_64.rpm                                                            |  93 kB  00:00:00
(6/10): mailcap-2.1.41-2.1.alios7.noarch.rpm                                                                  |  30 kB  00:00:00
(7/10): libzip-0.10.1-8.1.alios7.x86_64.rpm                                                                   |  47 kB  00:00:00
(8/10): php-5.4.16-36.1.alios7.x86_64.rpm                                                                     | 1.4 MB  00:00:00
(9/10): php-common-5.4.16-36.1.alios7.x86_64.rpm                                                              | 562 kB  00:00:00
(10/10): php-cli-5.4.16-36.1.alios7.x86_64.rpm                                                                | 2.7 MB  00:00:00
-------------------------------------------------------------------------------------------------------------------------------------Total                                                                                                 24 MB/s |  28 MB  00:00:01
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : apr-1.4.8-3.1.alios7.x86_64                                                                                      1/10
  Installing : apr-util-1.5.2-6.1.alios7.x86_64                                                                                 2/10
  Installing : httpd-tools-2.4.6-99.1.alios7.1.x86_64                                                                           3/10
  Installing : mailcap-2.1.41-2.1.alios7.noarch                                                                                 4/10
  Installing : alios-logos-70.0.6-3.alios7.noarch                                                                               5/10
  Installing : httpd-2.4.6-99.1.alios7.1.x86_64                                                                                 6/10
  Installing : libzip-0.10.1-8.1.alios7.x86_64                                                                                  7/10
  Installing : php-common-5.4.16-36.1.alios7.x86_64                                                                             8/10
  Installing : php-cli-5.4.16-36.1.alios7.x86_64                                                                                9/10
  Installing : php-5.4.16-36.1.alios7.x86_64                                                                                   10/10
  Verifying  : libzip-0.10.1-8.1.alios7.x86_64                                                                                  1/10
  Verifying  : httpd-tools-2.4.6-99.1.alios7.1.x86_64                                                                           2/10
  Verifying  : apr-1.4.8-3.1.alios7.x86_64                                                                                      3/10
  Verifying  : php-common-5.4.16-36.1.alios7.x86_64                                                                             4/10
  Verifying  : httpd-2.4.6-99.1.alios7.1.x86_64                                                                                 5/10
  Verifying  : alios-logos-70.0.6-3.alios7.noarch                                                                               6/10
  Verifying  : apr-util-1.5.2-6.1.alios7.x86_64                                                                                 7/10
  Verifying  : php-cli-5.4.16-36.1.alios7.x86_64                                                                                8/10
  Verifying  : php-5.4.16-36.1.alios7.x86_64                                                                                    9/10
  Verifying  : mailcap-2.1.41-2.1.alios7.noarch                                                                                10/10

Installed:
  php.x86_64 0:5.4.16-36.1.alios7

Dependency Installed:
  alios-logos.noarch 0:70.0.6-3.alios7      apr.x86_64 0:1.4.8-3.1.alios7                 apr-util.x86_64 0:1.5.2-6.1.alios7
  httpd.x86_64 0:2.4.6-99.1.alios7.1        httpd-tools.x86_64 0:2.4.6-99.1.alios7.1      libzip.x86_64 0:0.10.1-8.1.alios7
  mailcap.noarch 0:2.1.41-2.1.alios7        php-cli.x86_64 0:5.4.16-36.1.alios7           php-common.x86_64 0:5.4.16-36.1.alios7

Complete!
```

查看是否安装成功：

```shell
[root]# php -v
PHP 5.4.16 (cli) (built: Dec 13 2015 00:05:14)
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
```

### 步骤二：修改 obtest.php 文件中的数据库连接信息

在 Linux 环境下，可以使用 `vi obtest.php` 或者 `vim obtest.php` 命令编辑 `obtest.php` 文件，修改文件中的数据库连接信息，确保与实际情况相符。

示例如下：

```shell
[root]# vim obtest.php
<?php
$servername = "172.30.xxx.xxx";
$port = "2881";
$username = "root@mysql";
$password = "5xx";
$dbname = "test";

// 创建连接
$conn = mysqli_connect($servername, $username, $password, $dbname, $port);

// 检查连接是否成功
if (!$conn) {
    die("连接失败: " . mysqli_connect_error());
}
echo "连接成功";
?>
```

其中：

* `ervername` 是指服务器地址。
* `$username` 指连接数据库的用户名。
* `$password` 是连接数据库的密码。
* `$dbname` 指要连接的数据库名称。

### 步骤三：运行 obtest.php 文件并进行验证

测试故意输入错误密码，执行 `php obtest.php` 会返回如下示例及失败原因：

```shell
[root]# php obtest.php
PHP Warning:  mysqli_connect(): (42000/1045): Access denied for user 'root'@'xxx.xxx.xxx.xxx' (using password: YES) in /home/admin/obtest.php on line 9
连接失败: Access denied for user 'root'@'xxx.xxx.xxx.xxx' (using password: YES)
```

输入正确密码提示连接成功，返回示例如下：

```shell
[root]# php obtest.php
连接成功
```

测试建表及增删改查，测试示例如下：

```shell
[root]# vim obtest.php
<?php
$servername = "172.30.xxx.xxx"; // 服务器地址
$port = "2881";
$username = "root@mysql001"; // 用户名
$password = "_Ocexxxx"; // 密码
$dbname = "test"; // 要连接的数据库名称

// 创建连接
$conn = mysqli_connect($servername, $username, $password, $dbname, $port);

// 检查连接是否成功
if (!$conn) {
    die("连接失败: " . mysqli_connect_error());
}

// 创建表
$sql = "CREATE TABLE MyGuests (
id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
firstname VARCHAR(30) NOT NULL,
lastname VARCHAR(30) NOT NULL,
email VARCHAR(50),
reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)";
if (mysqli_query($conn, $sql)) {
    echo "表 MyGuests 创建成功";
} else {
    echo "创建表错误: " . mysqli_error($conn);
}

// 插入数据
$sql = "INSERT INTO MyGuests (firstname, lastname, email)
VALUES ('John', 'Doe', 'john@example.com')";
if (mysqli_query($conn, $sql)) {
    echo "新记录插入成功";
} else {
    echo "插入数据错误: " . mysqli_error($conn);
}
"obtest.php" 62L, 1596C
```

执行成功返回结果如下：

```shell
[root]# php obtest.php
表 MyGuests 创建成功新记录插入成功id: 1 - Name: John Doe<br>表 MyGuests 删除成功
```
