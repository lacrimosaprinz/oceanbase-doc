|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看定时分区均衡任务的触发历史

定时分区均衡任务 `SCHEDULED_TRIGGER_PARTITION_BALANCE` 开启后，可以通过视图来查看定时分区均衡任务的触发历史。


## 系统租户查看定时分区均衡任务的触发历史

1. 使用 root 用户登录集群的 sys 租户。

2. 执行以下命令，查看指定租户定时任务的历史调度情况。

   ```shell
   obclient [oceanbase]> SELECT * FROM oceanbase.CDB_SCHEDULER_JOB_RUN_DETAILS WHERE tenant_id=1002 AND job_name='SCHEDULED_TRIGGER_PARTITION_BALANCE';
   ```

   查询结果如下：

   ```shell
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+-----------+------+----------------------------+-------------------+----------------------------+----------------------------+
   | LOG_ID | LOG_DATE | OWNER | JOB_NAME                            | JOB_SUBNAME | STATUS | CODE  | REQ_START_DATE | ACTUAL_START_DATE | RUN_DURATION | INSTANCE_ID | SESSION_ID | SLAVE_PID | CPU_USED | CREDENTIAL_OWNER | CREDENTIAL_NAME | DESTINATION_OWNER | DESTINATION | MESSAGE                                                               | TENANT_ID | JOB  | TIME                       | JOB_CLASS         | GMT_CREATE                 | GMT_MODIFIED               |
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+-----------+------+----------------------------+-------------------+----------------------------+----------------------------+
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-06 00:00:00.123243 | DEFAULT_JOB_CLASS | 2024-06-06 00:00:00.123243 | 2024-06-06 00:00:00.123243 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-07 00:00:00.111650 | DEFAULT_JOB_CLASS | 2024-06-07 00:00:00.111650 | 2024-06-07 00:00:00.111650 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-08 00:00:00.116425 | DEFAULT_JOB_CLASS | 2024-06-08 00:00:00.116425 | 2024-06-08 00:00:00.116425 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-09 00:00:00.107195 | DEFAULT_JOB_CLASS | 2024-06-09 00:00:00.107195 | 2024-06-09 00:00:00.107195 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-10 00:00:00.109816 | DEFAULT_JOB_CLASS | 2024-06-10 00:00:00.109816 | 2024-06-10 00:00:00.109816 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |      1002 |   11 | 2024-06-11 00:00:00.107590 | DEFAULT_JOB_CLASS | 2024-06-11 00:00:00.107590 | 2024-06-11 00:00:00.107590 |
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+-----------+------+----------------------------+-------------------+----------------------------+----------------------------+
   6 rows in set
   ```

   有关视图 `CDB_SCHEDULER_JOB_RUN_DETAILS` 中各字段的详细说明，参见 [CDB_SCHEDULER_JOB_RUN_DETAILS](../../../../100.cdb_scheduler_job_run_details-of-sys-tenant.md)。


## 用户租户查看定时分区均衡任务的触发历史

1. 用户租户的租户管理员登录集群的 MySQL 租户或 Oracle 租户。

2. 执行以下命令，查看本租户定时任务的历史调度情况。

   :::tab
   tab MySQL 模式

   语句如下：

   ```shell
   obclient [oceanbase]> SELECT * FROM oceanbase.DBA_SCHEDULER_JOB_RUN_DETAILS WHERE job_name='SCHEDULED_TRIGGER_PARTITION_BALANCE';
   ```

   tab Oracle 模式

   语句如下：

   ```shell
   obclient [SYS]> SELECT * FROM SYS.DBA_SCHEDULER_JOB_RUN_DETAILS WHERE job_name='SCHEDULED_TRIGGER_PARTITION_BALANCE';
   ```
   :::

   查询结果的示例如下：

   ```shell
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+------+----------------------------+-------------------+----------------------------+----------------------------+
   | LOG_ID | LOG_DATE | OWNER | JOB_NAME                            | JOB_SUBNAME | STATUS | CODE  | REQ_START_DATE | ACTUAL_START_DATE | RUN_DURATION | INSTANCE_ID | SESSION_ID | SLAVE_PID | CPU_USED | CREDENTIAL_OWNER | CREDENTIAL_NAME | DESTINATION_OWNER | DESTINATION | MESSAGE                                                               | JOB  | TIME                       | JOB_CLASS         | GMT_CREATE                 | GMT_MODIFIED               |
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+------+----------------------------+-------------------+----------------------------+----------------------------+
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-06 00:00:00.123243 | DEFAULT_JOB_CLASS | 2024-06-06 00:00:00.123243 | 2024-06-06 00:00:00.123243 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-07 00:00:00.111650 | DEFAULT_JOB_CLASS | 2024-06-07 00:00:00.111650 | 2024-06-07 00:00:00.111650 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-08 00:00:00.116425 | DEFAULT_JOB_CLASS | 2024-06-08 00:00:00.116425 | 2024-06-08 00:00:00.116425 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-09 00:00:00.107195 | DEFAULT_JOB_CLASS | 2024-06-09 00:00:00.107195 | 2024-06-09 00:00:00.107195 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-10 00:00:00.109816 | DEFAULT_JOB_CLASS | 2024-06-10 00:00:00.109816 | 2024-06-10 00:00:00.109816 |
   |      0 | NULL     | NULL  | SCHEDULED_TRIGGER_PARTITION_BALANCE | NULL        | NULL   | -7124 | NULL           | NULL              |         NULL | NULL        |       NULL | NULL      |     NULL | NULL             | NULL            | NULL              | NULL        | partitions are already balanced, no need to trigger partition balance |   11 | 2024-06-11 00:00:00.107590 | DEFAULT_JOB_CLASS | 2024-06-11 00:00:00.107590 | 2024-06-11 00:00:00.107590 |
   +--------+----------+-------+-------------------------------------+-------------+--------+-------+----------------+-------------------+--------------+-------------+------------+-----------+----------+------------------+-----------------+-------------------+-------------+-----------------------------------------------------------------------+------+----------------------------+-------------------+----------------------------+----------------------------+
   6 rows in set
   ```

   有关视图 `DBA_SCHEDULER_JOB_RUN_DETAILS` 中各字段的详细说明，参见 [DBA_SCHEDULER_JOB_RUN_DETAILS](../../../../200.cdb_scheduler_job_run_details-of-oracle-mode.md)。









