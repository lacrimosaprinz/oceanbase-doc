|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看后台的分区均衡任务历史

分区均衡任务执行完成后，可以通过视图查看分区均衡任务的执行历史。

## 系统租户查看后台的分区均衡任务

1. 使用 `root` 用户登录集群的 sys 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@sys#obdemo -p***** -A
   ```

2. 执行以下语句，查看指定租户后台的分区均衡任务历史。

   * 查看指定租户的分区均衡任务历史。

     视图 `CDB_OB_BALANCE_JOB_HISTORY` 展示了所有租户宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_BALANCE_JOB_HISTORY WHERE TENANT_ID = 1002 AND JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     | TENANT_ID | JOB_ID | CREATE_TIME                | FINISH_TIME                | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS    | COMMENT | MAX_END_TIME |
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     |      1002 | 312280 | 2024-06-14 11:00:49.034035 | 2024-06-14 11:01:04.528871 | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | COMPLETED | NULL    | NULL         |
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     1 row in set
     ```

     有关视图 `CDB_OB_BALANCE_JOB_HISTORY` 中各字段的详细说明，参见 [CDB_OB_BALANCE_JOB_HISTORY](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/7300.o-cdb_ob_balance_job_history-of-sys-tenant.md)。

   * 查看指定租户 LS 级别的分区均衡任务历史。

     视图 `CDB_OB_BALANCE_TASK_HISTORY` 展示了所有租户日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。 

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_BALANCE_TASK_HISTORY WHERE TENANT_ID = 1002 AND BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TENANT_ID | TASK_ID | CREATE_TIME                | FINISH_TIME                | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS    | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |      1002 |  312281 | 2024-06-14 11:00:49.036806 | 2024-06-14 11:00:50.416084 | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |        1001 | COMPLETED | NULL        | 312282     |                       -1 | 312280 | NULL    | partition attribution alignment |
     |      1002 |  312282 | 2024-06-14 11:00:49.038509 | 2024-06-14 11:00:54.460059 | LS_TRANSFER |   1002 |    1001 | NULL      | 500129:500129      |          0 |                   1 |        1001 | COMPLETED | NULL        | 312283     |                       -1 | 312280 | NULL    | partition attribution alignment |
     |      1002 |  312283 | 2024-06-14 11:00:49.038509 | 2024-06-14 11:00:56.470614 | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |           0 | COMPLETED | NULL        | NULL       |                       -1 | 312280 | NULL    | partition attribution alignment |
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     3 rows in set
     ```

     有关视图 `CDB_OB_BALANCE_TASK_HISTORY` 中各字段的详细说明，参见 [CDB_OB_BALANCE_TASK_HISTORY](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/7500.o-cdb_ob_balance_task_history-of-sys-tenant.md)。

   * 查看指定租户 Tablet 级别的分区均衡任务历史。

     视图 `CDB_OB_TRANSFER_TASK_HISTORY` 展示了所有租户 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_TRANSFER_TASK_HISTORY WHERE TENANT_ID = 1002;
     ```

     查询结果如下：

     ```shell
     +-----------+---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     | TENANT_ID | TASK_ID | CREATE_TIME                | FINISH_TIME                | SRC_LS | DEST_LS | PART_LIST     | PART_COUNT | NOT_EXIST_PART_LIST | LOCK_CONFLICT_PART_LIST | TABLE_LOCK_TABLET_LIST | TABLET_LIST                                                                                      | TABLET_COUNT | START_SCN           | FINISH_SCN          | STATUS    | TRACE_ID                          | RESULT | BALANCE_TASK_ID | TABLE_LOCK_OWNER_ID | COMMENT |
     +-----------+---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     |      1002 |       1 | 2024-06-14 11:00:52.439818 | 2024-06-14 11:00:53.780044 |   1002 |    1001 | 500129:500129 |          1 | NULL                | NULL                    | NULL                   | 200070:0,1152921504606847005:0,1152921504606847006:0,1152921504606847007:0,1152921504606847008:0 |            5 | 1718334052840440001 | 1718334053449914002 | COMPLETED | YB42AC1E87DC-00061AC2E771139C-0-0 |      0 |          312282 |              312299 |         |
     +-----------+---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     1 row in set
     ```

     有关视图 `CDB_OB_TRANSFER_TASK_HISTORY` 中各字段的详细说明，参见 [CDB_OB_TRANSFER_TASK_HISTORY](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/11500.o-cdb_ob_transfer_task_history-of-sys-tenant.md)。


## 用户租户查看后台的分区均衡任务

1. 用户租户的租户管理员登录集群的 MySQL 租户或 Oracle 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@mysql_tenant#obdemo -p***** -A
   ```

2. 执行以下语句，查看本租户后台的分区均衡任务历史。

   :::tab
   tab MySQL 模式

   * 查看本租户的分区均衡任务历史。

     视图 `DBA_OB_BALANCE_JOB_HISTORY` 展示了当前租户宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等任务。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_BALANCE_JOB_HISTORY WHERE JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     | JOB_ID | CREATE_TIME                | FINISH_TIME                | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS    | COMMENT | MAX_END_TIME |
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+----------------- +-------------------------+-----------+---------+--------------+
     | 312280 | 2024-06-14 11:00:49.034035 | 2024-06-14 11:01:04.528871 | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | COMPLETED | NULL    | NULL         |
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     1 row in set
     ```

     有关视图 `DBA_OB_BALANCE_JOB_HISTORY` 中各字段的详细说明，参见 [DBA_OB_BALANCE_JOB_HISTORY](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/7400.o-dba_ob_balance_job_history-of-mysql-mode.md)。

   * 查看本租户 LS 级别的分区均衡任务历史。

     视图 `DBA_OB_BALANCE_TASK_HISTORY` 展示了本租户日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。 

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_BALANCE_TASK_HISTORY WHERE BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TASK_ID | CREATE_TIME                | FINISH_TIME                | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS    | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |  312281 | 2024-06-14 11:00:49.036806 | 2024-06-14 11:00:50.416084 | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |        1001 | COMPLETED | NULL        | 312282     |                       -1 | 312280 | NULL    | partition attribution alignment |
     |  312282 | 2024-06-14 11:00:49.038509 | 2024-06-14 11:00:54.460059 | LS_TRANSFER |   1002 |    1001 | NULL      | 500129:500129      |          0 |                   1 |        1001 | COMPLETED | NULL        | 312283     |                       -1 | 312280 | NULL    | partition attribution alignment |
     |  312283 | 2024-06-14 11:00:49.038509 | 2024-06-14 11:00:56.470614 | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |           0 | COMPLETED | NULL        | NULL       |                       -1 | 312280 | NULL    | partition attribution alignment |
     +---------+----------------------------+----------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     3 rows in set
     ```

     有关视图 `DBA_OB_BALANCE_TASK_HISTORY` 中各字段的详细说明，参见 [DBA_OB_BALANCE_TASK_HISTORY](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/7600.o-dba_ob_balance_task_history-of-mysql-mode.md)。

   * 查看本租户 Tablet 级别的分区均衡任务历史。

     视图 `DBA_OB_TRANSFER_TASK_HISTORY` 展示了当前租户 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_TRANSFER_TASK_HISTORY;
     ```

     查询结果如下：

     ```shell
     +---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     | TASK_ID | CREATE_TIME                | FINISH_TIME                | SRC_LS | DEST_LS | PART_LIST     | PART_COUNT | NOT_EXIST_PART_LIST | LOCK_CONFLICT_PART_LIST | TABLE_LOCK_TABLET_LIST | TABLET_LIST                                                                                      | TABLET_COUNT | START_SCN           | FINISH_SCN          | STATUS    | TRACE_ID                          | RESULT | BALANCE_TASK_ID | TABLE_LOCK_OWNER_ID | COMMENT |
     +---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     |       1 | 2024-06-14 11:00:52.439818 | 2024-06-14 11:00:53.780044 |   1002 |    1001 | 500129:500129 |          1 | NULL                | NULL                    | NULL                   | 200070:0,1152921504606847005:0,1152921504606847006:0,1152921504606847007:0,1152921504606847008:0 |            5 | 1718334052840440001 | 1718334053449914002 | COMPLETED | YB42AC1E87DC-00061AC2E771139C-0-0 |      0 |          312282 |              312299 |         |
     +---------+----------------------------+----------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+--------------------------------------------------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     1 row in set
     ```

     有关视图 `DBA_OB_TRANSFER_TASK_HISTORY` 中各字段的详细说明，参见 [DBA_OB_TRANSFER_TASK_HISTORY](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/12300.o-dba_ob_transfer_task_history-of-mysql-mode.md)。

   tab Oracle 模式

   * 查看本租户的分区均衡任务历史。

     视图 `DBA_OB_BALANCE_JOB_HISTORY` 展示了当前租户宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等任务。

     ```shell
     obclient [SYS]> SELECT * FROM SYS.DBA_OB_BALANCE_JOB_HISTORY WHERE JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     | JOB_ID | CREATE_TIME                  | FINISH_TIME                  | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS    | COMMENT | MAX_END_TIME |
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     | 346408 | 14-JUN-24 01.59.59.014732 PM | 14-JUN-24 02.00.09.055400 PM | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | COMPLETED | NULL    | NULL         |
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+-----------+---------+--------------+
     1 row in set
     ```

     有关视图 `DBA_OB_BALANCE_JOB_HISTORY` 中各字段的详细说明，参见 [DBA_OB_BALANCE_JOB_HISTORY](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/11000.dba_ob_balance_job_history-of-oracle-mode.md)。

   * 查看本租户 LS 级别的分区均衡任务历史。

     视图 `DBA_OB_BALANCE_TASK_HISTORY` 展示了本租户日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。

     ```shell
     obclient [sys]> SELECT * FROM SYS.DBA_OB_BALANCE_TASK_HISTORY WHERE BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TASK_ID | CREATE_TIME                  | FINISH_TIME                  | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS    | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |  346409 | 14-JUN-24 01.59.59.016760 PM | 14-JUN-24 02.00.00.652394 PM | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |        1001 | COMPLETED | NULL        | 346410     |                       -1 | 346408 | NULL    | partition attribution alignment |
     |  346410 | 14-JUN-24 01.59.59.017468 PM | 14-JUN-24 02.00.04.959125 PM | LS_TRANSFER |   1002 |    1001 | NULL      | 500021:500021      |          0 |                   1 |        1001 | COMPLETED | NULL        | 346411     |                       -1 | 346408 | NULL    | partition attribution alignment |
     |  346411 | 14-JUN-24 01.59.59.017468 PM | 14-JUN-24 02.00.06.970879 PM | LS_ALTER    |   1002 |      -1 | NULL      | NULL               |          0 |                   0 |           0 | COMPLETED | NULL        | NULL       |                       -1 | 346408 | NULL    | partition attribution alignment |
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------+--------------------+------------+---------------------+-------------+-----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     3 rows in set
     ```

     有关视图 `DBA_OB_BALANCE_TASK_HISTORY` 中各字段的详细说明，参见 [DBA_OB_BALANCE_TASK_HISTORY](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/11200.dba_ob_balance_task_history-of-oracle-mode.md)。

   * 查看本租户 Tablet 级别的分区均衡任务历史。

     视图 `DBA_OB_TRANSFER_TASK_HISTORY` 展示了当前租户 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [SYS]> SELECT * FROM SYS.DBA_OB_TRANSFER_TASK_HISTORY;
     ```

     查询结果如下：

     ```shell
     +---------+------------------------------+------------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     | TASK_ID | CREATE_TIME                  | FINISH_TIME                  | SRC_LS | DEST_LS | PART_LIST     | PART_COUNT | NOT_EXIST_PART_LIST | LOCK_CONFLICT_PART_LIST | TABLE_LOCK_TABLET_LIST | TABLET_LIST                                          | TABLET_COUNT | START_SCN           | FINISH_SCN          | STATUS    | TRACE_ID                          | RESULT | BALANCE_TASK_ID | TABLE_LOCK_OWNER_ID | COMMENT |
     +---------+------------------------------+------------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     |       1 | 14-JUN-24 02.00.02.675095 PM | 14-JUN-24 02.00.04.443093 PM |   1002 |    1001 | 500021:500021 |          1 | NULL                | NULL                    | NULL                   | 200007:0,1152921504606846987:0,1152921504606846988:0 |            3 | 1718344803084664002 | 1718344803870702005 | COMPLETED | YB42AC1E87DC-00061AC2EE113D0F-0-0 |      0 |          346410 |              346428 | NULL    |
     +---------+------------------------------+------------------------------+--------+---------+---------------+------------+---------------------+-------------------------+------------------------+------------------------------------------------------+--------------+---------------------+---------------------+-----------+-----------------------------------+--------+-----------------+---------------------+---------+
     1 row in set
     ```

     有关视图 `DBA_OB_TRANSFER_TASK_HISTORY` 中各字段的详细说明，参见 [DBA_OB_TRANSFER_TASK_HISTORY](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/15700.dba_ob_transfer_task_history-of-oracle-mode.md)。

   :::

## 相关文档

[查看后台的分区均衡任务](500.view-background-partition-balancing-task.md)
