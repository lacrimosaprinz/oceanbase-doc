# 为用户指定代理用户

OceanBase 数据库的 Oracle 模式支持代理用户功能。通过代理用户功能，一个用户 A（即代理用户）能够被授权代表其他用户 B（即目标用户）连接到数据库并使用用户 B 的身份执行数据库操作。

## 背景信息

假设当前环境中有以下两个用户 `USERA` 和 `USERB`，用户 `USERB` 拥有两个角色 `emplyee` 和 `developer` 的权限，现在需要授权 `USERA` 作为用户 `USERB` 的代理用户。

## 前提条件

被代理的用户（即目标用户）需要具备 `ALTER USER` 系统权限，才可以执行 `ALTER USER` 命令，查看权限的相关操作请参见 [查看用户权限](../300.permission-of-oracle-mode/600.view-user-permissions-of-oracle-mode.md)。如果目标用户没有 `ALTER USER` 系统权限，请联系管理员为其添加，为用户添加权限的相关操作请参见 [直接授予权限](../300.permission-of-oracle-mode/200.authority-of-oracle-mode.md)。

## 授权代理用户---comments：只能是角色权限生效吗？其他系统权限、对象权限都不生效吗？

1. 用户 `USERB` 登录集群的 Oracle 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uUSERB@oracletenant#obdemo -p*****
   ```

2. 执行以下语句，授权用户 `USERA` 代理用户 `USERB`。

   ```sql
   ALTER USER 
   ```

   示例如下：

   * 授权用户 `USERA` 代理用户 `USERB`，且登录后用户 `USERB` 的所有角色均生效

      ```shell
      obclient [USERB]> ALTER USER USERB GRANT CONNECT THROUGH USERA;
      ```   

   * 授权用户 `USERA` 代理用户 `USERB`，且登录后仅用户 `USERB` 的 `employee` 角色生效

      ```shell
      obclient [USERB]> ALTER USER USERB GRANT CONNECT THROUGH USERA WITH ROLE employee;
      ```   

   * 授权用户 `USERA` 代理用户 `USERB`，且登录后用户 `USERB` 的所有角色均不生效

      ```shell
      obclient [USERB]> ALTER USER USERB GRANT CONNECT THROUGH USERA WITH NO ROLE;
      ```   

   * 授权用户 `USERA` 代理用户 `USERB`，且登录后除了 `employee` 角色，用户 `USERB` 的其他角色均生效

      ```shell
      obclient [USERB]> ALTER USER USERB GRANT CONNECT THROUGH USERA WITH ROLE ALL EXCEPT employee;
      ```   

3. 执行成功后，退出用户 `USERB` 的连接。

4. 执行以下命令，使用用户 `USERA` 代理登录用户 `USERB`。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uUSERA@oracletenant#obdemo -p***** --proxy_user USERB 
   ```

## 撤销代理用户

1. 用户 `USERB` 登录集群的 Oracle 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uUSERB@oracletenant#obdemo -p*****
   ```

2. 执行以下语句，撤销代理用户 `USERA` 的代理权限。

   ```shell
   obclient [USERB]> ALTER USER USERB REVOKE CONNECT THROUGH USERA;
   ```

## 相关文档

[ALTER USER]()