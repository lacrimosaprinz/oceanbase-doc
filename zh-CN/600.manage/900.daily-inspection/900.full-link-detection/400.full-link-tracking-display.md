|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 全链路追踪展示

全链路追踪展示功能帮助用户轻松管理和分析业务系统。此功能允许用户在通过 JDBC 或 SQL 接口连接到业务数据库时，设置一个与调用请求关联的 Trace ID。这个 Trace ID 随后被记录在 OceanBase 数据库的全链路追踪系统中，便于用户后续进行系统性能分析和故障排查。使用 Show Trace 命令，用户可以查询到与 Trace ID 相关的详细信息，以更清晰地了解系统的运行状况。

## 通过 OceanBase 运维平台（OCP）查看追踪信

您可以通过 OCP 快速查找特定的请求，从而执行系统性能分析和故障排查。

### 定位分析

OCP 支持多种检索维度，如耗时检索、Trace ID 或 SQL ID 检索等，帮助用户快速定位问题所在。此外，OCP 还提供了一种直观的全链路追踪信息展示方式，允许用户查看请求在客户端到数据库内部各环节的执行详情。

### 操作步骤

在 OCP 中可通过以下步骤查询链路信息，更多内容请参见 [查询链路](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000002100810)。

1. 登录 OCP。
2. 在左侧导航栏中选择 **系统管理 > 日志服务**。
3. 单击 **链路查询** 页签，进入 **链路查询** 界面。
4. 通过在 **链路查询** 界面中设置查询条件，辅助定位目标 Trace。
5. 单击 **查询** 按钮。将光标悬停至 span 节点的时间轴上，在弹窗中将展示 span 的详细信息。

![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E9%93%BE%E8%B7%AF%E8%AF%A6%E6%83%851.png#id=V3CTc&originHeight=773&originWidth=1665&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

## 通过命令行查看追踪信息

你也可以在 OceanBase 数据库的命令行界面使用 Show Trace 功能，该功能方便用户在执行 SQL 语句后，快速获取执行过程的详细调用链路和耗时信息。通过这种方式，你可以轻松发现性能瓶颈并进行进一步的分析和调优。

### 定位分析

当用户在命令行中手动执行某个语句后，如果需要对其执行过程进行性能分析或调优，可以使用 Show Trace 功能来查看该语句的执行调用链路情况以及链路中各阶段的耗时情况。通过该功能，用户可以便捷地找到性能瓶颈点，进而进行分析和优化。

### 操作步骤

如下示例展示了两个分布式并行执行任务（px_task）的执行情况。若要查看链路有关的日志信息，请参见 [基于 Trace 功能查找上一次 SQL 请求日志](https://www.oceanbase.com/docs/common-oceanbase-database-cn-10000000001702462)。

1.  启用 SQL Trace 功能。

    ```shell
    obclient [test]>SET ob_enable_show_trace = 1;
    ```

2.  手动执行需要查询的 SQL 语句。

    ```shell
    obclient [test]>select/*+parallel(2)*/ count(*) from t1;
    +----------+
    | count(*) |
    +----------+
    |        5 |
    +----------+
    1 row in set (0.005 sec)
    ```

3.  通过 `SHOW TRACE` 语句查看该语句的执行调用链路情况以及链路中各阶段的耗时情况。

    ```shell
    obclient [test]>show trace;
    +-------------------------------------------+----------------------------+------------+
    | Operation                                 | StartTime                  | ElapseTime |
    +-------------------------------------------+----------------------------+------------+
    | obclient                                  | 2023-06-25 17:51:30.143537 | 4.667 ms   |
    | └─ ob_proxy                               | 2023-06-25 17:51:30.143716 | 4.301 ms   |
    |    └─ com_query_process                   | 2023-06-25 17:51:30.145119 | 2.527 ms   |
    |       └─ mpquery_single_stmt              | 2023-06-25 17:51:30.145123 | 2.513 ms   |
    |          ├─ sql_compile                   | 2023-06-25 17:51:30.145133 | 0.107 ms   |
    |          │  └─ pc_get_plan                | 2023-06-25 17:51:30.145135 | 0.061 ms   |
    |          └─ sql_execute                   | 2023-06-25 17:51:30.145252 | 2.350 ms   |
    |             ├─ open                       | 2023-06-25 17:51:30.145252 | 0.073 ms   |
    |             ├─ response_result            | 2023-06-25 17:51:30.145339 | 2.186 ms   |
    |             │  ├─ px_schedule             | 2023-06-25 17:51:30.145342 | 1.245 ms   |
    |             │  │  ├─ px_task              | 2023-06-25 17:51:30.146391 | 1.113 ms   |
    |             │  │  │  ├─ get_das_id        | 2023-06-25 17:51:30.146979 | 0.001 ms   |
    |             │  │  │  ├─ do_local_das_task | 2023-06-25 17:51:30.147012 | 0.050 ms   |
    |             │  │  │  └─ close_das_task    | 2023-06-25 17:51:30.147237 | 0.014 ms   |
    |             │  │  └─ px_task              | 2023-06-25 17:51:30.146399 | 0.868 ms   |
    |             │  │     ├─ get_das_id        | 2023-06-25 17:51:30.147002 | 0.001 ms   |
    |             │  │     ├─ do_local_das_task | 2023-06-25 17:51:30.147036 | 0.041 ms   |
    |             │  │     └─ close_das_task    | 2023-06-25 17:51:30.147183 | 0.011 ms   |
    |             │  └─ px_schedule             | 2023-06-25 17:51:30.147437 | 0.001 ms   |
    |             └─ close                      | 2023-06-25 17:51:30.147536 | 0.049 ms   |
    |                └─ end_transaction         | 2023-06-25 17:51:30.147571 | 0.002 ms   |
    +-------------------------------------------+----------------------------+------------+
    ```
