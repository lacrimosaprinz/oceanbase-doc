|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 网络工具

## sar

`sar` 用于 System ActivityReporter 系统活动情况报告。包括：文件的读写情况、系统调用的使用情况、磁盘 I/O、CPU 效率、内存使用状况、进程活动及 IPC 有关的活动等。我们可以利用 sar 工具来监控网络情况。

命令行形式：

```unknow
sar -n [keyword]  [ <interval> [ <count> ] ]
```

参数说明：

* -n：表示网络性能监控。

* keyword 的取值如下：

  * DEV：显示网络接口信息。
  * EDEV：显示关于网络错误的统计数据。
  * NFS：统计活动的 NFS 客户端的信息。
  * NFSD：统计 NFS 服务器的信息。
  * SOCK：显示套接字信息。
  * ALL：显示所有 5 个开关。

* interval：输出刷新的间隔时间。

* count：输出的次数。

通过 `sar -n` 命令查看每个网卡上的流量传输速率。示例如下：

```unknow
$sar -n DEV 1
09:01:53 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
09:01:54 PM        lo      7.07      7.07      0.45      0.45      0.00      0.00      0.00
09:01:54 PM      eth0     62.63     19.19      4.18      2.57      0.00      0.00      0.00
09:01:54 PM      eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:54 PM     bond0     62.63     19.19      4.18      2.57      0.00      0.00      0.00
```

字段说明：

* IFACE：服务器网卡名称。

* rxpck/s：每秒接受的数据包。

* txpck/s：每秒发送的数据包。

* rxKB/S：每秒接受的数据包大小，单位为 KB。

* txKB/S：每秒发送的数据包大小，单位为 KB。

* rxcmp/s：每秒接受的压缩数据包。

* txcmp/s：每秒发送的压缩包。

* rxmcst/s：每秒接收的多播数据包。

## vsar

`vsar` 用于对一段时间的网络负载情况进行回溯。

通过 `vsar --traffic --tcp` 命令对网络负载情况进行回溯。示例如下：

```unknow
Time              -------------------------------tcp------------------------------ ---------------------traffic--------------------
Time              active  pasive    iseg  outseg  EstRes  AtmpFa  CurrEs  retran    bytin  bytout   pktin  pktout  pkterr  pktdrp
18/10/21-16:22:28   2.20   27.40  249.60  222.20    0.20    0.00  223.00    0.00    50.0K   37.2K  249.00  202.00    0.00    0.00
18/10/21-16:22:33   3.20   20.60  247.40  230.60    0.00    0.00  198.00    0.00    76.6K   32.0K  256.00  205.00    0.00    0.00
18/10/21-16:22:38   2.00   25.60    3.6K   50.5K    0.00    0.00  216.00    0.01   276.8K   73.4M    3.6K   50.5K    0.00    0.00
18/10/21-16:22:43   3.80   29.00  243.80  214.60    0.00    0.00  232.00    0.47    53.1K   32.1K  255.00  206.00    0.00    0.00
18/10/21-16:22:48   2.00   31.20  251.20  217.00    0.00    1.00  238.00    0.46    53.5K   35.1K  274.00  221.00    0.00    0.00
18/10/21-16:22:53   1.20   25.60    2.6K   37.1K    0.00    0.00  228.00    0.00   207.8K   54.1M    2.6K   37.1K    0.00    0.00
18/10/21-16:22:58   0.40   27.00    1.2K   16.6K    0.00    0.00  225.00    0.00   110.0K   24.1M    1.2K   16.6K    0.00    0.00
18/10/21-16:23:03   2.40   25.60    3.7K   50.4K    0.00    0.00  217.00    0.00   281.3K   73.4M    3.7K   50.4K    0.00    0.00
```

字段说明：

* tcp

  * active：主动发起连接的每秒次数。
  * pasive：被动生成连接的每秒次数。
  * iseg：TCP 段流入每秒数量。
  * outseg：TCP 段流出每秒数量。
  * EstRes：连接被重置的每秒次数。
  * AtmpFa：发起连接失败的每秒次数。如：半连接队列满导致 syn 包被丢弃等等。
  * CurrEs：当前 TCP 连接数。
  * retran：根据重传 segment 和总的 segment，计算出来的重传率。

* traffic

  * bytin：物理主机物理网卡 rx 方向的流量大小，单位 bytes/s。一般 10 g 的网卡，达到 960 M 基本就到了物理网卡的极限。
  * bytout：物理主机物理网卡 tx 方向的流量大小，单位 bytes/s。
  * pktin：物理主机物理网卡 rx 方向的 pps。
  * pktout：物理主机物理网卡 tx 方向的 pps。
  * inerr：入方向的包错误数。
  * outerr：出方向的包错误数。
  * indrp：入方向的丢包数。
  * outdrp：出方向的丢包数。
