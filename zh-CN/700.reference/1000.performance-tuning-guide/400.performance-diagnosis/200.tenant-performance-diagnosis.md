|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 租户性能诊断

本文介绍了如何对 OceanBase 租户进行性能监控和诊断。

## 租户性能监控

1. 登录 OCP，在左侧导航栏，单击 **租户** 。

2. 在 **租户概览** 页面的 **租户列表** 区域，选择待操作的租户并单击其租户名。

3. 在显示的页面的左侧导航栏上，单击 **性能监控** 。

4. 打开实时性能开关，可看到性能的实时变化。

![租户性能监控](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/tenent-performance.png)

|   筛选对象   |                                                           说明                                                            |
|----------|-------------------------------------------------------------------------------------------------------------------------|
| 选择时间     | 监控展示的时间范围，支持查看近 30 天数据。                                                                                                 |
|自动刷新  |默认关闭，打开后，每 5s 进行一次刷新。|
| Zone     | OceanBase 是分布式数据库，租户在多个 Zone 上有数据副本。租户监控由多个 Zone 的副本采集汇总而成。汇总方式由指标类型决定。选择单个 Zone，只展示 Zone 所在的租户副本的监控数据。                 |
| OBServer | OceanBase 是分布式数据库，租户在多个OBServer 有数据副本。租户监控由多个 OBServer 的副本采集汇总而成。汇总方式由指标类型决定。选择单个 OBServer，只展示对应 OBServer 所在的租户副本的监控数据。 |

性能指标分性能与 SQL、事务、存储与缓存 ，更多详情请参见 [监控指标](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000001538876)。

## 租户 SQL 诊断

  <main id="notice" >
    <h4>功能适用性</h4>
    <p>目前社区版 OCP 暂不支持可疑 SQL 诊断功能。</p>
  </main>

1. 登录 OCP，在左侧导航栏，单击 **租户** 。

2. 在租户概览页面的租户列表区域，选择待操作的租户并单击其租户名。

3. 在显示的页面的左侧导航栏上，单击 **SQL 诊断** 。

![SQL诊断](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7232489461/p429724.png)

SQL 提供四种诊断能力，接下来分别从性能异常、全局把控、慢查询角度给出分析。

|   能力    |                                         说明                                         |
|---------|------------------------------------------------------------------------------------|
| 可疑 SQL  | OCP 的 SQL 诊断引擎识别性能异常 SQL，并给出诊断结果，可识别执行计划变化、性能下降、执行突刺等场景。您应优先根据可疑 SQL 结果，对SQL 进行调优。 |
| TopSQL  | TopSQL 也叫全量 SQL，根据响应时间排序，支持 Top 2000 展示。通过 TopSQL 可以对运行的 SQL 进行整体的把控。              |
| SlowSQL | OCP 的 SQL 诊断引擎将单次执行耗时超过 100ms 的 SQL 提取出来。支持通过慢查询视角，对 SQL 进行调优。                     |
|ParallelSQL |ParallelSQL 是指租户中使用并行调度机制执行的 SQL。您可通过 ParallelSQL 诊断查看 AP 查询性能不符合预期的 SQL。|

在 SQL 执行计划没有选择最优索引时，在 SQL 详情页面支持对索引进行在线绑定。绑定索引后，新请求走新的执行计划。

![索引绑定](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5629721461/p347420.png)

## 会话监控和诊断

1. 登录 OCP，在左侧导航栏，单击 **租户** 。

2. 在 **租户概览** 页面的 **租户列表** 区域，选择待操作的租户并单击其租户名。

3. 在显示的页面的左侧导航栏上，单击 **会话管理** 。

![aa](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5629721461/p374560.png)

会话管理功能模块说明

|    模块    |                                                             说明                                                              |
|----------|-----------------------------------------------------------------------------------------------------------------------------|
| 租户会话     | 展示当前会话信息，包括活跃和非活跃会话，您可以对指定的会话进行 Kill 操作。                                                                                    |
| 会话统计     | 支持按用户、访问来源、数据库、是否活跃进行分析。                                                                                                    |
| 死锁分析     | 支持对当前租户、指定会话进行死锁诊断。                                                                                                         |
| 活跃会话历史报告 | 一段时间内的活跃会话历史报告，帮助您对历史会话进行分析和问题排查。时间范围跨度限制在 60 分钟内，并且只能选择近 8 天的会话进行分析。 报告支持在线查看和下载，OCP 保留近 90 天内生成的活跃会话历史报告。 |

更多关于租户的性能报诊断信息，请参见 [性能诊断](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000001542137)。