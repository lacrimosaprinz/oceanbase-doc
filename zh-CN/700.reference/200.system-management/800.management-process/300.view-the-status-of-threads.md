|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看线程状态

在数据库的运行过程中，您可以根据需要查看当前集群中的线程状态，以便进行问题排查或性能诊断。

## 背景信息

线程可以分为工作线程和后台线程，工作线程是区分租户的，又称为租户工作线程；后台线程中既有分租户的线程又有不分租户的线程。

## 操作步骤

1. 管理员用户登录集群的 MySQL 租户或 Oracle 租户。

2. 执行以下命令，查看线程状态。

   * MySQL 模式

     ```sql
     SELECT * FROM oceanbase.GV$OB_THREAD;
     ```

     查询的部分结果的示例如下。

     ```shell
     +----------------+----------+-----------+------+-----------------+--------+------------+------------+-----------------------------------+
     | SVR_IP         | SVR_PORT | TENANT_ID | TID  | TNAME           | STATUS | LATCH_WAIT | LATCH_HOLD | TRACE_ID                          |
     +----------------+----------+-----------+------+-----------------+--------+------------+------------+-----------------------------------+
     | xx.xx.xx.xx    |     2882 |      1002 | 7268 | T1002_MFLaunch  | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7267 | T1002_MergeSche | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7266 | T1002_FrzInfoDe | Wait   |            |            | YB42AC1E87F4-0005FBC6A0F81772-0-0 |
     | xx.xx.xx.xx    |     2882 |      1002 | 7265 | T1002_ServerPro | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7264 | T1002_Occam     | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7263 | T1002_L0_G2     | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7262 | T1002_L0_G2     | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7102 | T1002_L0_G0     | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7101 | T1002_L0_G0     | Wait   |            |            | Y0-0000000000000000-0-0           |
     | xx.xx.xx.xx    |     2882 |      1002 | 7100 | T1002_L0_G0     | Wait   |            |            | Y0-0000000000000000-0-0           |
     +----------------+----------+-----------+------+-----------------+--------+------------+------------+-----------------------------------+
     10 rows in set
     ```

   * Oracle 模式

     ```sql
     SELECT * FROM SYS.GV$OB_THREAD;
     ```

     查询的部分结果的示例如下。

     ```shell
     +----------------+----------+-----------+------+--------------+--------+------------+------------+-------------------------+
     | SVR_IP         | SVR_PORT | TENANT_ID | TID  | TNAME        | STATUS | LATCH_WAIT | LATCH_HOLD | TRACE_ID                |
     +----------------+----------+-----------+------+--------------+--------+------------+------------+-------------------------+
     | xx.xx.xx.xx    |     2882 |      1004 | 7372 | T1004_CdcSrv | Sleep  | NULL       | NULL       | Y0-0000000000000000-0-0 |
     +----------------+----------+-----------+------+--------------+--------+------------+------------+-------------------------+
     1 row in set

   查询结果中的每一行表示一个线程，不同时间查询的结果可能不同。每当有新的线程被创建时，系统就会在表中添加一行新的线程信息；同样的，当某个线程结束时，系统就会从表中删除该线程所在的行。

   查询结果中的部分字段说明如下。

   |    字段   |                            描述                               |
   |-----------|--------------------------------------------------------------|
   | SVR_IP    | 当前线程所在的 OBServer 节点的 IP 地址                             |
   | SVR_PORT  | 当前线程所在的 OBServer 节点的端口号                               |
   | TENANT_ID | 当前线程所属的租户，进程级线程的 `tenant_id` 为 500。               |
   | TID       | 线程号                                                          |
   | TNAME     | 线程名                                                         |
   | STATUS    | 线程状态：<ul><li>Run：表示线程处于运行状态 </li><li>Wait：表示线程处于等待状态</li><li>Sleep：表示线程处于休眠状态</li><li>Join：表示线程在等待另一个线程结束</li></ul>                                                   |
   | LATCH_WAIT  | 当前线程正在等待的 Latch 的地址                                          |
   | LATCH_HOLD  | 当前线程持有的 Latch 的地址，可能包含多个                     |
   | TRACE_ID    | 当前线程上正在执行的 Trace 的 id                                   |

   有关视图 `GV$OB_THREAD` 中字段的详细说明，请参见 [GV$OB_THREAD](../../700.system-views/400.system-view-of-mysql-mode/300.performance-view-of-mysql-mode/12800.gv_ob_thread-of-mysql-mode.md)。

## 更多信息

关于 OceanBase 数据库线程的更多详情，请参见 [线程简介](../../100.oceanbase-database-concepts/1200.observer-node-architecture/300.observer-thread-model/100.thread-introduction.md)。
