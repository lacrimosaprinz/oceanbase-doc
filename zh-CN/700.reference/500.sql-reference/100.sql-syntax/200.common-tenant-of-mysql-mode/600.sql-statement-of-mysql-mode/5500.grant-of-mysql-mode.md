# GRANT

## 描述

`GRANT` 语句用于系统管理员授予用户某些权限。

## 权限要求

* 执行 `GRANT` 语句时，当前用户必须拥有被授予的权限。例如，想要使用用户 `user1` 为用户 `user2` 授予表 `tbl1` 的 `SELECT` 权限，则用户 `user1` 必须拥有表 `tbl1` 的 `SELECT` 权限。

* 执行 `GRANT` 语句时，当前用户需拥有 `GRANT OPTION` 权限。关 OceanBase 数据库权限的详细介绍，请参见 [MySQL 模式下的权限分类](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md)。
<!-- 这个链接里没有 GRANT OPTION 权限介绍 -->
<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>为用户授权后，该用户需重新连接 OceanBase 数据库，权限才能生效。</p>
</main>

## 语法

```sql
GRANT {priv_type [, priv_type...]} 
    ON priv_level 
    TO {user [, user...]} 
    {WITH GRANT OPTION | empty}
-- {WITH GRANT OPTION | empty} 这里的 empty 是指可以不设置么
priv_type: 
      ALL [PRIVILEGES] 
    | ALTER [TENANT] 
    | CREATE {RESOURCE POOL  | [USER]} 
    | DELETE 
    | DROP [DATABASE LINK] 
    | GRANT OPTION 
    | INSERT 
    | UPDATE 
    | SELECT 
    | INDEX 
    | CREATE {RESOURCE UNIT  | VIEW} 
    | SHOW VIEW 
    | SHOW DATABASES 
    | SUPER 
    | PROCESS 
    | USAGE 
    | FILEX 
    | ALTER SYSTEM 
    | REPLICATION SLAVE 
    | REPLICATION CLIENT 
    | CREATE DATABASE LINK

priv_level:  
      *[.*] 
    | db_name{[.*]  | .table_name}

user:
      user_name
    | user_name IDENTIFIED [WITH auth_plugin] BY password 
    | user_name IDENTIFIED [WITH auth_plugin] BY PASSWORD password
```

## 参数解释

|                 **参数**   |          **描述**        |
|----------------------------------------|--------------------------------------|
| priv_type                              | 指定授予的权限类型，可以授予多个权限，多个权限间使用英文逗号（`,`）隔开。具体的权限类型及其说明请参见下方权限类型说明表。    |
| priv_level                             | 指定授予权限的层级。可以指定在所有数据库和所有表上生效（`*.*`）、指定数据库或指定表生效（`db_name.*`，`*.table_name`）、或者特定的数据库中特定的表生效（`db_name.table_name`）。 |
| user | 指定要授予权限的用户，可以是一个或多个用户，多个用户间使用英文逗号（`,`）隔开。如果用户不存在，该语句会直接创建用户。  |
| auth_plugin | 用于指定用户身份验证的方式，目前仅支持 `mysql_native_password` 身份验证插件。 |
| BY password | 为待创建的用户创建一个密码，此处密码为明文，存入 `mysql.user` 表后，服务器端会变为密文存储下来。如果密码中包含特殊字符 <code>~!@#%^&*_-+=`\|(){}[]:;',.?/</code>，需使用英文引号（<code>'</code> 或 <code>"</code>）包含。 |
| BY PASSWORD password | 为待创建的用户创建一个密码，此处密码为密文，将直接存入 `mysql.user` 表。 |
| WITH GRANT OPTION  | 设置允许授予其他用户相同的权限。 |

可以授予的权限类型如下表所示。
<!-- 待更新 -->
|      **权限**       |                                 **说明**                                 |
|-------------------|------------------------------------------------------------------------|
| ALL PRIVILEGES    | 除 `GRANT OPTION` 以外所有权限。                                               |
| ALTER             | `ALTER TABLE` 的权限。                                                     |
| CREATE            | `CREATE TABLE` 的权限。                                                    |
| CREATE USER       | `CREATE USER`、`DROPUSER`、`RENAME USER` 和 `REVOKE ALL  PRIVILEGES` 的权限。 |
| CREATE VIEW       | `CREATE VIEW` 与 `DROP VIEW` 的权限。                                       |
| DELETE            | `DELETE` 的权限。                                                          |
| DROP              | `DROP` 的权限。                                                            |
| GRANT OPTION      | `GRANT OPTION` 的权限。                                                    |
| INDEX             | `CREATE INDEX` 与 `DROP INDEX` 的权限。                                     |
| INSERT            | `INSERT` 的权限。                                                          |
| PROCESS           |  通过 `SHOW PROCESSLIST` 命令查看其他用户的进程。|
| SELECT            | `SELECT` 的权限。                                                          |
| SHOW DATABASES    | 全局 `SHOW DATABASES` 的权限。                                               |
| SHOW VIEW         | `SHOW CREATE VIEW` 权限。                                                 |
| SUPER             | `SET GLOBAL` 修改全局系统参数的权限。                                         |
| UPDATE            | `UPDATE` 的权限。                                                          |
| USAGE             |  没有权限的同义词。|

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>目前没有 Change Effective Tenant 的权限控制，因此 sys 租户下的用户都可以进行授权。</p>
</main>
<!-- 看不懂，需确认是否保留 -->

## 示例

* 为已存在的用户 use1 赋予数据库 db1 的 CREATE VIEW 权限，并设置允许授予其他用户相同的权限。
  
  ```shell
  obclient> GRANT CREATE VIEW ON db1.* TO use1 WITH GRANT OPTION;
  ```
  <!-- 我之前创建也没有选择 WITH 这一块儿，也可以为其他用户创建呀 -->

* 为已存在的用户 use1 赋予数据库 db1 的 CREATE 权限，并修改 use1 的密码。
  
  ```shell
  obclient> GRANT CREATE ON db1.* TO use1 IDENTIFIED by '********';
  ```

  执行后查看 `mysql.user` 表中 use1 用户的密码，会看到已更新为最新设置的密码。

* 为不存在的用户 use2 赋予数据库 db1 的 CREATE 权限，并为 use2 设置密码。
  
  ```shell
  obclient> GRANT CREATE ON db1.* TO use2 IDENTIFIED by '********';
  ```

## 相关文档

* 授予用户权限的操作可参见 [授予权限](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/200.authority-of-mysql-mode.md)。

* 可从 `mysql.user` 表中查看创建的用户信息，`mysql.user` 表的详细介绍可参见 [mysql.user](../../../../700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/4000.mysql-user-of-mysql-mode.md)。
