| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |

# RATIO_TO_REPORT

## 描述

该函数是一个分析函数，功能是计算一个值与一组值之和的比率。

## 语法

```sql
RATIO_TO_REPORT(expr) OVER ([query_partition_clause])
```

## 参数解释

|  参数  |                                               说明                                               |
|------|------------------------------------------------------------------------------------------------|
| expr | 指定需要查询的字段。 <br>**注意**  不能使用 `RATIO_TO_REPORT` 函数或其他分析函数来嵌套 `expr`。 |
| OVER | 使用 `OVER` 子句定义窗口进行计算。详细信息请参见 [分析函数说明](../400.analysis-functions-of-oracle-mode/100.window-function-description-of-oracle-mode.md)。        |

## 返回类型

如果 `expr` 为 `NULL`，则返回结果为 `NULL`。否则返回结果为数值类型数据。

## 示例

现有已创建的表 `emp_msg`。查询 `emp_msg` 表中，按 `deptno` 字段分组，求列 `mgr` 中各值占 `mgr` 总计的比例。

```sql
obclient> SELECT * FROM emp_msg;
+--------+--------+------+------+
| DEPTNO | ENAME  | SAL  | MGR  |
+--------+--------+------+------+
|     10 | CLARK  | 2750 | 7839 |
|     10 | KING   | 5300 | NULL |
|     10 | MILLER | 1600 | 7782 |
|     20 | ADAMS  | 1400 | 7788 |
|     20 | FORD   | 3300 | 7566 |
|     20 | JONES  | 3275 | 7839 |
|     20 | SCOTT  | 3300 | 7566 |
|     20 | SMITH  | 1100 | 7902 |
|     30 | ALLEN  | 1900 | 7698 |
|     30 | BLAKE  | 3150 | 7839 |
|     30 | JAMES  | 1250 | 7698 |
|     30 | MARTIN | 1550 | 7698 |
|     30 | TURNER | 1800 | 7698 |
|     30 | WARD   | 1550 | 7698 |
|     30 | SCLARK | 1750 | 7839 |
+--------+--------+------+------+
15 rows in set

obclient> SELECT deptno,ename,mgr,RATIO_TO_REPORT(mgr) OVER (PARTITION BY deptno)
      FROM emp_msg;
+--------+--------+------+---------------------------------------------+
| DEPTNO | ENAME  | MGR  | RATIO_TO_REPORT(MGR)OVER(PARTITIONBYDEPTNO) |
+--------+--------+------+---------------------------------------------+
|     10 | CLARK  | 7839 |   .5018244670635682734780103706548876512387 |
|     10 | KING   | NULL |                                        NULL |
|     10 | MILLER | 7782 |   .4981755329364317265219896293451123487613 |
|     20 | ADAMS  | 7788 |   .2014433149685729805230076821603165981221 |
|     20 | FORD   | 7566 |   .1957010941258632730658803445332505625824 |
|     20 | JONES  | 7839 |   .2027624738108171025064018002638317684488 |
|     20 | SCOTT  | 7566 |   .1957010941258632730658803445332505625824 |
|     20 | SMITH  | 7902 |   .2043920229688833708388298285093505082641 |
|     30 | ALLEN  | 7698 |   .1421134249003101462117855560478511298183 |
|     30 | BLAKE  | 7839 |   .1447164377492246344705361098803721754541 |
|     30 | JAMES  | 7698 |   .1421134249003101462117855560478511298183 |
|     30 | MARTIN | 7698 |   .1421134249003101462117855560478511298183 |
|     30 | TURNER | 7698 |   .1421134249003101462117855560478511298183 |
|     30 | WARD   | 7698 |   .1421134249003101462117855560478511298183 |
|     30 | SCLARK | 7839 |   .1447164377492246344705361098803721754541 |
+--------+--------+------+---------------------------------------------+
15 rows in set
```
