| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |

# REGR_ (Linear Regression)

## 描述

该函数是线性回归函数，将普通最小二乘法回归线拟合到一组数字对上。可以将其用作聚合或分析函数。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <ul>
    <li>作为分析函数使用时，需要使用 <code>OVER</code> 子句定义窗口进行计算。它对一组行的集合进行计算并返回多个值。</li>
    <li>作为聚合函数使用时，该函数对一组行的集合进行聚合计算，结果只能返回一个值，此时不需要加 <code>OVER</code> 子句。</li>
    </ul>
  </main>

## 语法

```sql
{ REGR_SLOPE
 | REGR_INTERCEPT
 | REGR_COUNT
 | REGR_R2
 | REGR_AVGX
 | REGR_AVGY
 | REGR_SXX
 | REGR_SYY
 | REGR_SXY
}(expr1 , expr2)
  [ OVER (analytic_clause) ]
```

## 参数解释

|       参数       |                                                                                                                                                               说明                                                                                                                                                                |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| REGR_SLOPE     | 返回直线的坡度（斜率）。返回值是数值数据类型，可以为 `NULL`。 忽略空数值对（`expr1`,`expr2`）后，它进行以下计算： ```sql COVAR_POP(expr1, expr2) / VAR_POP(expr2)```                                                                                                                                                |
| REGR_INTERCEPT | 返回回归线的 `y` 截距。返回值是数值数据类型，可以为 `NULL`。 忽略空数值对（`expr1`,`expr2`）后，它进行以下计算： ```sql AVG(expr1) - REGR_SLOPE(expr1, expr2) * AVG(expr2)```                                                                                                                                    |
| REGR_COUNT     | 返回用于填充回归线的非空数值对的数目，是一个整数。                                                                                                                                                                                                                                                                                                       |
| REGR_R2        | 返回回归的确定系数（也称为 R 平方或拟合优度）。返回值是数值数据类型，可以为 `NULL`。 忽略 `VAR_POP(expr1)` 和 `VAR_POP(expr2)` 的空值后进行评估。返回值为： ```sql NULL if VAR_POP(expr2)  = 0 1 if VAR_POP(expr1)  = 0 and VAR_POP(expr2) != 0 POWER(CORR(expr1,expr),2) if VAR_POP(expr1)  > 0 and VAR_POP(expr2  != 0```  |
| REGR_AVGX      | 返回回归线的自变量（`expr2`）的平均值。 忽略空数值对（`expr1`,`expr2`）后，进行以下计算： ```sql AVG(expr2)```                                                                                                                                                                                          |
| REGR_AVGY      | 返回回归线的因变量（`expr1`）的平均值。 忽略空数值对（`expr1`,`expr2`）后，进行以下计算： ```sql AVG(expr1)```                                                                                                                                                                                          |
| REGR_SXX       | 返回值等于在忽略空数值对（`expr1`,`expr2`）后数值对的个数乘以自变量的值的总体方差，即下面公式的计算结果： ```sql REGR_COUNT(expr1, expr2) * VAR_POP(expr2)```                                                                                                                                                                       |
| REGR_SYY       | 返回值等于在忽略空数值对（`expr1`,`expr2`）后数值对的个数乘以因变量的值的总体方差，即下面公式的计算结果： ```sql REGR_COUNT(expr1, expr2) * VAR_POP(expr1)```                                                                                                                                                                       |
| REGR_SXY       | 返回值等于在忽略空数值对（`expr1`,`expr2`）后的数值对的个数乘以总体协方差，即下面公式的计算结果： ```sql REGR_COUNT(expr1, expr2) * COVAR_POP(expr1, expr2)```                                                                                                                                                                  |
| expr1          | 指定因变量的值（y 值）。                                                                                                                                                                                                                                                                                                                   |
| expr2          | 指定自变量的值（x 值）。                                                                                                                                                                                                                                                                                                                   |
| OVER           | 使用 `OVER` 子句定义窗口进行计算。详细信息请参见 [分析函数说明](../400.analysis-functions-of-oracle-mode/100.window-function-description-of-oracle-mode.md)。                                                                                                                                                                                                                                         |

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p><code>REGR_SXX</code> 、<code>REGR_SYY</code> 和 <code>REGR_SXY</code> 是用于计算各种诊断统计数据的辅助函数。</p>
  </main>

## 返回类型

返回值是数值数据类型或 `NULL`。

## 示例

现有已创建表 `tbl1`。

```sql
obclient> SELECT * FROM tbl1;
+------+------+------+------+
| COL1 | COL2 | COL3 | COL4 |
+------+------+------+------+
|    1 | A1   |    8 |   12 |
|    1 | A2   |   10 |   15 |
|    1 | A3   |   11 |   16 |
|    2 | B1   |    9 |   14 |
|    2 | B2   |   10 |   15 |
|    2 | B3   |    8 |   13 |
|    2 | B4   |   11 |   16 |
|    3 | C1   |    8 |   18 |
|    3 | C2   |    9 |   16 |
|    3 | C3   |   10 |   15 |
|    3 | C4   |   11 |   12 |
|    3 | C5   |   12 |   10 |
|    4 | d1   |    8 | NULL |
|    4 | d1   |    9 |   10 |
|    4 | d1   |   10 | NULL |
+------+------+------+------+
15 rows in set
```

### 聚合函数示例

计算数值对列 `col3` 与列 `col4` 线性回归的三种类型的诊断统计量。

```sql
obclient> SELECT col1,REGR_SXX(col3,col4) "REGR_SXX",
            REGR_SYY(col3,col4) "REGR_SYY",
            REGR_SXY(col3,col4) "REGR_SXY"
          FROM tbl1
          GROUP BY col1;
+------+----------------------------------------+------------------------------------------+----------------------------------------+
| COL1 | REGR_SXX                               | REGR_SYY                                 | REGR_SXY                               |
+------+----------------------------------------+------------------------------------------+----------------------------------------+
|    1 | 8.666666666666666666666666666666666667 | 4.66666666666666666666666666666666666701 | 6.333333333333333333333333333333333333 |
|    2 |                                      5 |                                        5 |                                      5 |
|    3 |                                   40.8 |                                       10 |                                    -20 |
|    4 |                                      0 |                                        0 |                                      0 |
+------+----------------------------------------+------------------------------------------+----------------------------------------+
4 rows in set
```

### 分析函数示例

按列 `col1` 分组和列 `col2` 升序排序，计算数值对列 `col3` 与列 `col4` 的累计斜率。

```sql
obclient> SELECT col1,col2,col3,col4,
            REGR_SLOPE(col3,col4) OVER(PARTITION BY col1 ORDER BY col2) "REGR_SLOPE"
          FROM tbl1;
+------+------+------+------+--------------------------------------------+
| COL1 | COL2 | COL3 | COL4 | REGR_SLOPE                                 |
+------+------+------+------+--------------------------------------------+
|    1 | A1   |    8 |   12 |                                       NULL |
|    1 | A2   |   10 |   15 |  .6666666666666666666666666666666666666667 |
|    1 | A3   |   11 |   16 |  .7307692307692307692307692307692307691642 |
|    2 | B1   |    9 |   14 |                                       NULL |
|    2 | B2   |   10 |   15 |                                          1 |
|    2 | B3   |    8 |   13 |                                          1 |
|    2 | B4   |   11 |   16 |                                          1 |
|    3 | C1   |    8 |   18 |                                       NULL |
|    3 | C2   |    9 |   16 |                                        -.5 |
|    3 | C3   |   10 |   15 | -.6428571428571428571428571428571428570956 |
|    3 | C4   |   11 |   12 | -.5066666666666666666666666666666666666667 |
|    3 | C5   |   12 |   10 | -.4901960784313725490196078431372549019608 |
|    4 | d1   |    8 | NULL |                                       NULL |
|    4 | d1   |    9 |   10 |                                       NULL |
|    4 | d1   |   10 | NULL |                                       NULL |
+------+------+------+------+--------------------------------------------+
15 rows in set
```
