# CREATE INDEX

## 描述

该语句用来创建索引。索引是创建在表上的，对数据库表中一列或多列的值进行排序的一种结构。其作用主要在于提高查询的速度，降低数据库系统的性能开销。

OceanBase 数据库当前版本支持的索引类型包含唯一索引和非唯一索引，创建索引时可以通过 `STORING(column_name,...)` 指定索引表上的冗余列。索引表的冗余列除了包含用户指定添加的列外，还会自动添加上主键表的主键列（如果无主键表则包含 Hidden PK）。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>在 OceanBase 数据库 Oracle 模式下，如果删除表中的任一索引列，则所创建的索引失效。</p>
</main>

## 权限要求

执行 `CREATE INDEX` 语句创建索引需要当前用户至少拥有对应对象的 INDEX 权限。有关 OceanBase 数据库权限的详细介绍，请参见 [Oracle 模式下的权限分类](../../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/300.permission-of-oracle-mode/000.permission-classification-of-oracle-mode.md)。

## 语法

```sql
CREATE [hint_options]  [UNIQUE] INDEX index [USING BTREE | USING HASH] ON table (sort_column_key [, sort_column_key...]) [index_option...] [partition_option | auto_partition_option]

index:   
      index_name [USER_VARIABLE opt_reverse_link_flag] 
    | schema_name.table_name [USER_VARIABLE opt_reverse_link_flag]

table:  
      table_nema 
    | schema_name.table_name

sort_column_key:  
    index_expr [ASC | DESC] opt_null_pos [ID id]

opt_null_pos:  
      empty 
    | NULLS LAST 
    | NULLS FIRST

index_option:  
      GLOBAL 
    | LOCAL 
    | BLOCK_SIZE [=] integer 
    | COMMENT STRING_VALUE 
    | STORING (column_name_list) 
    | WITH ROWID 
    | WITH PARSER STRING_VALUE 
    | index_using_algorithm 
    | visibility_option 
    | DATA_TABLE_ID [=] data_table_id 
    | INDEX_TABLE_ID [=] index_table_id 
    | MAX_USED_PART_ID [=] used_part_id 
    | physical_attributes_option 
    | REVERSE 
    | parallel_option

parallel_option:  
      PARALLEL [=] integer 
    | NOPARALLEL

partition_option:  
      hash_partition 
    | range_partition 
    | list_partition 
    | external_table_partition

auto_partition_option: 
      auto_partition_type PARTITION SIZE (conf_const | AUTO) PARTITIONS AUTO

auto_partition_type:  
      PARTITION BY RANGE (column_name [, column_name...])

```

## 参数说明

| 参数项   | 描述    |
|--------|---------|
| hint_options | 指定 Hint 选项，为可选项。 |
| \[UNIQUE] | 可选项，用于指定创建唯一索引。 |
| index  | 指定待创建的索引名称，详细介绍可参见下文 [index](#index)。 |
| [USING BTREE | USING HASH] | 可选项，指定用于创建索引的算法。ul><li>BTREE 表示使用 B-tree 算法创建索引。</li><li>HASH 表示使用哈希算法创建索引。</li></ul> |
| table | 指定要在其上创建索引的表或视图，详细介绍可参见下文 [table](#table)。 |
| sort_column_key | 指定一个排序列的键，创建索引时可以指定多个排序列，多个排序列使用英文逗号(`,`)分开，详细介绍可参见下文 [sort_column_key](#sort_column_key)。 |
| index_option | 指定索引选项，创建索引时可以指定多个索引选项，多个索引选项使用英文空格分开，详细介绍可参见下文 [index_option](#index_option)。 |
| partition_option | 指定创建索引分区的选项，详细介绍可参见下文 [partition_option](#partition_option)。 |
| auto_partition_option | 指定创建索引自动分区，详细介绍可参见下文 [auto_partition_option](#auto_partition_option)。 |

### index

<!-- 索引名字命名时有什么限制 -->

### table

* table_name：指定表或视图的名字。
  
  例如，在名为 t1 的表上创建一个名为 index1 的索引。

  ```sql
  CREATE INDEX index1 ON t1 (column_name);
  ```

* schema_name.table_name：表示表名和别名的组合。
  
  例如，在 test 数据库中的 t2 表上创建一个名为 index2 的索引。

  ```sql
  CREATE INDEX index2 ON test.t1 (column_name);
  ```

### sort_column_key

* index_expr：指定排序所依据的列或表达式，但是不允许是布尔表达式，例如 `c1=c1`。OceanBase 数据库当前版本禁止创建生成列上的函数索引。函数索引所支持的表达式参见 [函数索引支持的系统函数列表](../../../../../300.database-object-management/200.manage-object-of-oracle-mode/400.manage-indexes-of-oracle-mode/500.function-index-list-of-supported-functions-of-oracle-mode.md)。

* ASC：可选项，表示按升序排序，默认为升序。

* DESC：可选项，表示按降序排序，默认为升序。

* opt_null_pos：指定空值在排序中的位置，有如下三种取值。

  * empty：表示未指定空值位置，在默认情况下将遵循数据库管理系统的默认行为。

  * NULLS LAST：指定空值在排序结果中出现在非空值之后。

  * NULLS FIRST：指定空值在排序结果中出现在非空值之前。

* ID id：可选项，表示排序键的 ID 号。

例如，在名为 t3 的表上创建一个名为 index3 的索引，指定该索引在 c1 列上按升序进行排序，并指定空值在排序结果中出现在非空值之后。
  
```sql
CREATE INDEX index3 ON t3 (c1 ASC NULLS LAST);
```

### index_option
<!-- 需要确认有哪些是支持的 -->

* GLOBAL：表示创建全局索引。

* LOCAL：表示创建局部索引。

* BLOCK_SIZE [=] integer：指定索引块的大小，即每个索引块中的字节数。

* COMMENT STRING_VALUE：为索引添加注释

* STORING (column_name_list)：指定要存储在索引中的列。

* WITH ROWID：创建包含行标识符的索引。

* WITH PARSER STRING_VALUE：指定索引所需的解析器。

* index_using_algorithm：指定索引所使用的算法。

* visibility_option：指定索引的可见性。

* DATA_TABLE_ID [=] data_table_id：指定索引所属的数据表 ID。

* INDEX_TABLE_ID [=] index_table_id：指定索引表的 ID。

* MAX_USED_PART_ID [=] used_part_id：指定索引的最大已使用分区 ID。

* physical_attributes_option：定义索引的物理属性选项。

* REVERSE：指定创建逆序索引。

* parallel_option：指定索引的并行情况。

  * PARALLEL [=] integer：指定并行执行的级别，integer 是一个整数，表示执行的并行度。

  * NOPARALLEL：指定禁用并行执行

### partition_option

* hash_partition：用于指定哈希分区。

* range_partition：用于指定范围分区。

* list_partition：用于指定列表分区。

* external_table_partition：用于指定外部表分区。

## auto_partition_option

* auto_partition_type：用于指定自动分区的类型。

  * PARTITION BY RANGE：表示对分区进行范围分区。

  * column_name [, column_name...]：指定范围分区的列列表，多个列表使用英文逗号（`,`）分开。

* conf_const：表示使用一个配置常量来定义分区的大小。

* AUTO：表示自动确定分区的大小。

* PARTITIONS AUTO：表示自动确定分区数。

## 相关文档

* [索引简介](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000221064)
* [创建索引](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000220157)
* [查看索引](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000220160)
* [删除索引](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000220155)
