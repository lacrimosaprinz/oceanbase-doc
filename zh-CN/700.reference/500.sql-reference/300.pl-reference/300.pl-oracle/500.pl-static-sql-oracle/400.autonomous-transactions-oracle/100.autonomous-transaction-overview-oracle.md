| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |

# 自治事务概述 

自治事务是由另一个事务（主事务）启动的独立事务。自治事务执行 SQL 操作并提交或回滚，而无需提交或回滚主事务。

  <main id="notice" >
    <h4>功能适用性</h4>
    <p>该内容仅适用于 OceanBase 数据库企业版。OceanBase 数据库社区版仅提供 MySQL 模式。</p>
  </main>

尽管自治事务是由另一个事务启动的，但它不是嵌套事务，原因如下：

* 它不与主事务共享事务资源（例如锁）。

  

* 它不依赖于主事务。例如，如果主事务回滚，则嵌套事务回滚，而自治事务不回滚。

  

* 它提交的更改将立即对其他事务可见。

  在主事务提交之前，嵌套事务的提交更改对其他事务不可见。
  

* 自治事务中引发的异常会导致事务级回滚，而不是语句级回滚。

  




自治事务的优势 
----------------------------

启动后，自治事务是完全独立的。它与主事务不共享锁、资源或提交依赖项。即使主事务回滚，也可以记录事件，递增重试计数器等。

自治事务可帮助您构建模块化的可重用软件组件。您可以将自治事务封装在存储的子程序中。调用的应用程序不需要知道该存储的子程序执行的操作是成功还是失败。

事务环境 
-------------------------

主事务与嵌套例程共享其上下文，但与自治例程不共享。当一个自治例程调用另一个自治例程（或递归地调用）时，该例程不共享任何事务上下文。当自治例程调用非自治例程时，这些例程共享相同的事务上下文。

事务可见性 
--------------------------

自治事务提交时，自治事务所做的更改将对其他事务可见。如果将其隔离级别设置为 `READ COMMITTED`（默认），则在主事务恢复时这些更改将对主事务可见。

如果将主事务的隔离级别设置为 `SERIALIZABLE`，则当主事务恢复时，其自治事务所做的更改将对主事务不可见，示例如下：

```unknow
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
```


  <main id="notice" type='explain'>
    <h4>说明</h4>
    <ul>
    <li>事务属性仅适用于设置了事务属性的事务。</li>
    <li>游标属性不受自治事务的影响。</li>
    </ul>
  </main>

  




声明自治例程 
---------------------------

要声明自治例程，请使用 `AUTONOMOUS_TRANSACTION` 编译指令。

为了便于阅读，建议将 `AUTONOMOUS_TRANSACTION` 编译指令放在声明部分的顶部。（在声明部分的任何位置都允许使用该编译指令。）

您不能将 `AUTONOMOUS_TRANSACTION` 编译指令应用于整个程序包或 ADT，但是可以将其应用于程序包中的每个子程序或 ADT 的每个方法。

